<?php
/**
 * class Produtos_Model
 * 
 *      Classe responsável pelo CRUD de da tabela PRODUTOS
 * 
 *  - GET   -
 *  - getById   - 
 *  - 
 * 
 * 
 * 
 * 
 */
class Produtos_model extends CI_Model {

    function __construct() {
        parent::__construct();
    }

/**
 ********************************************************************************************************************************************
 ********************************************************************************************************************************************
 ********************************************************************************************************************************************
 * ----------------------------------------------------
 *          GET
 * ----------------------------------------------------
 *
 *
 *
 *
 *
 *
 */

    function get($table,$fields,$where='',$perpage=0,$start=0,$one=false,$array='array'){

        $this->db->select($fields);
        $this->db->from($table);
        $this->db->order_by('idProdutos','desc');
        $this->db->limit($perpage,$start);
        if($where){
            $this->db->where($where);
        }

        $query = $this->db->get();

        $result =  !$one  ? $query->result() : $query->row();
        return $result;
    }
/**
 ********************************************************************************************************************************************
 ********************************************************************************************************************************************
 ********************************************************************************************************************************************
 * ----------------------------------------------------
 *          GETBYCATEGORIA
 * ----------------------------------------------------
 *
 *
 *
 *
 *
 *
     */

    function getByCategoria($table,$fields,$where,$limit=false, $one=false,$array='array'){

        $this->db->select($fields);
        $this->db->from($table);
        $this->db->order_by('idProdutos','desc');
        $this->db->where('produtos.categoria_prod_id', $where);
        $this->db->join('imagem_produto', "produtos.idProdutos = imagem_produto.produtos_id AND imagem_produto.descricao = 'principal'");
        if ($limit != false){
            $this->db->limit($limit);
        }
        $query = $this->db->get();

        $result =  !$one  ? $query->result() : $query->row();
        return $result;
    }

/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          GETBYID
 * ----------------------------------------------------
 * 
 * 
 */

    function getById($id){
        $this->db->where('idProdutos',$id);
        $this->db->limit(1);
        return $this->db->get('produtos')->row();
    }

/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          ADD
 * ----------------------------------------------------
 * 
 *
 * 
 */

    // Adiciona no banco
    function add($data, $return_id=nul){
        $this->db->insert('produtos', $data);         
        
        // Caso somente uma linha seja afetada
        if ($this->db->affected_rows() == '1'){
           // caso o parametro de retorno de id seja TRUE
           if ($return_id == TRUE) {
               return $this->db->insert_id();
           }else{
                return TRUE;
            }
        }
        
        return FALSE;       
    }

/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          ADDBYID
 * ----------------------------------------------------
 * 
 *
 * 
 */

    function addById($id, $data){
        $this->db->where('idProdutos',$id);
        $this->db->limit(1);

        return $this->db->update('produtos', $data);
    }

/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          EDIT
 * ----------------------------------------------------
 * 
 *  
 *
 */    

    function edit($data,$where){
        $this->db->where($where);
        $this->db->update('produtos', $data);

        if ($this->db->affected_rows() >= 0)
        {
            return TRUE;
        }
        
        return FALSE;       
    }

/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          DELETE
 * ----------------------------------------------------
 *
 *
 *
 */

    function delete($table,$fieldID,$ID){
        $this->db->where($fieldID,$ID);
        $this->db->delete($table);
        if ($this->db->affected_rows() == '1')
        {
            return TRUE;
        }

        return FALSE;
    }

/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          COUNT
 * ----------------------------------------------------
 * 
 *  
 *
 */

    function count($table){
        return $this->db->count_all($table);
    }

/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          COUNT_SITE
 * ----------------------------------------------------
 * 
 *  
 *
 */

    function count_site(){
        $this->db->like('exibir', '1');
        $this->db->from('produtos');
        return $this->db->count_all_results();
    }


/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          ADDSITE
 * ----------------------------------------------------
 * 
 *
 *
 *      VERIFICAR E EXCLUIR METODO VERSÃO ATUALIZADA EM mapos_model/imageProfile
 */

    function addIMG($data, $return_id=nul){
        $this->db->insert('imagem_produto', $data);
        
        // Caso somente uma linha seja afetada
        if ($this->db->affected_rows() == '1'){
           // caso o parametro de retorno de id seja TRUE
           if ($return_id = TRUE) {
               return $this->db->insert_id();
           }else{
                return TRUE;
            }
        }
        
        return FALSE;       
    }
/**
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
 * ----------------------------------------------------
 *          VISUALIZAR
 * ----------------------------------------------------
 * 
 *  
 *
 */       
    function getIMG($fields,$where='',$url=false,$one=false,$array='array'){
        
        $this->db->select($fields);
        $this->db->from('imagem_produto');
        if($where){
            $this->db->where($where);
        }
        
        $query = $this->db->get();
        
        $result =  !$one  ? $query->result() : $query->row();

        if($url == true){
            foreach ($result as $value) {

                $final[] = $value->url;

            }

            return $final;
        }else{
            return $result;
        }
    
    }


    function editImg($data,$where){
        $this->db->where($where);
        $this->db->update('imagem_produto', $data);

        if ($this->db->affected_rows() >= 0)
        {
            return TRUE;
        }

        return FALSE;
    }


}